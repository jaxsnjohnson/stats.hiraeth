<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>D&D 5e Stat Block (URL-based, View/Embed)</title>
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, viewport-fit=cover"
    />
    <style>
      :root {
        --bg: #f8f6f1;
        --panel: #ffffff;
        --ink: #1a1a1a;
        --accent: #b89a67;
        --rule: #d8ccb2;
        --muted: #555;
        --red: #9c2b2e;
        --link: #2b6cb0;
        --radius: 8px;
        --shadow: 0 1px 3px rgba(0, 0, 0, 0.06);
      }

      html,
      body {
        background: var(--bg);
        color: var(--ink);
        margin: 0;
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica,
          Arial, "Apple Color Emoji", "Segoe UI Emoji";
        line-height: 1.4;
      }

      .wrap {
        max-width: 920px;
        margin: 20px auto 64px;
        padding: 0 16px;
        display: grid;
        gap: 16px;
      }

      /* Toolbar (Editor) */
      .toolbar {
        background: var(--panel);
        border: 1px solid var(--rule);
        border-radius: var(--radius);
        box-shadow: var(--shadow);
        padding: 12px;
        display: grid;
        gap: 8px;
      }

      .toolbar-row {
        display: grid;
        grid-template-columns: repeat(12, 1fr);
        gap: 8px;
      }

      .toolbar .field {
        display: grid;
        gap: 4px;
      }

      .toolbar label {
        font-size: 12px;
        color: var(--muted);
      }

      .toolbar input[type="text"],
      .toolbar input[type="number"],
      .toolbar textarea {
        width: 100%;
        box-sizing: border-box;
        padding: 8px 10px;
        border: 1px solid var(--rule);
        border-radius: 6px;
        background: #fffdf8;
        font-size: 14px;
      }

      .toolbar textarea {
        min-height: 64px;
        resize: vertical;
      }

      .toolbar .actions {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
        align-items: center;
      }

      .btn {
        appearance: none;
        border: 1px solid var(--accent);
        background: #f7f2e7;
        color: #2a2a2a;
        padding: 8px 12px;
        border-radius: 6px;
        cursor: pointer;
        font-weight: 600;
      }

      .btn.primary {
        background: #caa970;
        color: #fff;
        border-color: #a7844b;
      }

      .btn:active {
        transform: translateY(1px);
      }

      /* Stat block card - flatter look */
      .statblock {
        background: #fffef9;
        border: 1px solid var(--rule);
        border-radius: var(--radius);
        box-shadow: var(--shadow);
        overflow: hidden;
      }

      .sb-header {
        background: #f2e9d6;
        border-bottom: 1px solid var(--rule);
        padding: 14px 16px;
      }

      .sb-name {
        font-family: Georgia, "Times New Roman", serif;
        font-size: 26px;
        font-weight: 800;
        color: var(--red);
        letter-spacing: 0.2px;
      }

      .sb-subtitle {
        color: #333;
        margin-top: 4px;
        font-style: italic;
        font-size: 14px;
      }

      .sb-body {
        padding: 14px 16px 12px;
      }

      .hr {
        height: 2px;
        background: var(--accent);
        margin: 10px 0;
        opacity: 0.7;
      }

      .sb-row {
        margin: 6px 0;
      }

      .sb-label {
        font-variant: small-caps;
        font-weight: 700;
      }

      .abilities {
        display: grid;
        grid-template-columns: repeat(6, 1fr);
        gap: 8px;
        margin: 10px 0;
      }

      .ability {
        background: #fff;
        border: 1px solid var(--rule);
        border-radius: 6px;
        text-align: center;
        padding: 8px 6px;
      }

      .ability .abbr {
        font-variant: small-caps;
        font-weight: 700;
        color: #4a4a4a;
      }

      .ability .score {
        font-size: 18px;
        font-weight: 700;
      }

      .ability .mod {
        color: var(--muted);
      }

      .section {
        margin: 12px 0;
      }

      .entry {
        margin: 6px 0;
      }

      .entry .name {
        font-weight: 700;
        font-style: italic;
      }

      .description {
        white-space: pre-wrap;
        background: #fff;
        border: 1px solid var(--rule);
        border-radius: 6px;
        padding: 10px;
        margin-top: 8px;
      }

      .footer-note {
        color: var(--muted);
        font-size: 12px;
        margin-top: 8px;
      }

      .small {
        font-size: 13px;
      }

      a {
        color: var(--link);
        text-decoration: none;
      }

      a:hover {
        text-decoration: underline;
      }

      .col-3 {
        grid-column: span 3;
      }
      .col-4 {
        grid-column: span 4;
      }
      .col-6 {
        grid-column: span 6;
      }
      .col-8 {
        grid-column: span 8;
      }
      .col-12 {
        grid-column: span 12;
      }

      @media (max-width: 840px) {
        .toolbar-row {
          grid-template-columns: repeat(6, 1fr);
        }
        .col-8 {
          grid-column: span 6;
        }
        .col-6 {
          grid-column: span 6;
        }
        .col-4 {
          grid-column: span 6;
        }
        .col-3 {
          grid-column: span 3;
        }
      }

      @media (max-width: 520px) {
        .toolbar-row {
          grid-template-columns: repeat(4, 1fr);
        }
        .col-8,
        .col-6,
        .col-4,
        .col-3 {
          grid-column: span 4;
        }
      }

      /* Embed modes */
      .embed-root {
        margin: 0;
        padding: 0;
        background: transparent;
      }

      .embed-root .wrap {
        margin: 0;
        padding: 0;
        max-width: none;
      }

      .embed-root .statblock {
        border: none;
        border-radius: 0;
        box-shadow: none;
        background: #fffef9;
      }

      .hidden {
        display: none !important;
      }
    </style>
  </head>
  <body>
    <div class="wrap" id="root-wrap">
      <div class="toolbar" id="toolbar">
        <div class="toolbar-row">
          <div class="field col-8">
            <label for="name">Name</label>
            <input id="name" type="text" placeholder="Ancient Red Dragon" />
          </div>
          <div class="field col-4">
            <label for="cr">Challenge Rating (CR)</label>
            <input id="cr" type="text" placeholder="24 (62,000 XP)" />
          </div>
        </div>

        <div class="toolbar-row">
          <div class="field col-3">
            <label for="size">Size</label>
            <input id="size" type="text" placeholder="Huge" />
          </div>
          <div class="field col-3">
            <label for="type">Type</label>
            <input id="type" type="text" placeholder="dragon" />
          </div>
          <div class="field col-3">
            <label for="alignment">Alignment</label>
            <input id="alignment" type="text" placeholder="chaotic evil" />
          </div>
          <div class="field col-3">
            <label for="prof">Proficiency Bonus</label>
            <input id="prof" type="text" placeholder="+7" />
          </div>
        </div>

        <div class="toolbar-row">
          <div class="field col-4">
            <label for="ac">Armor Class</label>
            <input id="ac" type="text" placeholder="22 (natural armor)" />
          </div>
          <div class="field col-4">
            <label for="hp">Hit Points</label>
            <input id="hp" type="text" placeholder="546 (28d20 + 252)" />
          </div>
          <div class="field col-4">
            <label for="hit_dice">Hit Dice</label>
            <input id="hit_dice" type="text" placeholder="28d20+252" />
          </div>
        </div>

        <div class="toolbar-row">
          <div class="field col-12">
            <label for="speed"
              >Speed (comma-separated: walk 40 ft., fly 80 ft., swim 40
              ft.)</label
            >
            <input
              id="speed"
              type="text"
              placeholder="40 ft., fly 80 ft., swim 40 ft."
            />
          </div>
        </div>

        <div class="toolbar-row">
          <div class="field col-2 col-3">
            <label for="str">STR</label>
            <input id="str" type="number" placeholder="30" />
          </div>
          <div class="field col-2 col-3">
            <label for="dex">DEX</label>
            <input id="dex" type="number" placeholder="10" />
          </div>
          <div class="field col-2 col-3">
            <label for="con">CON</label>
            <input id="con" type="number" placeholder="29" />
          </div>
          <div class="field col-2 col-3">
            <label for="int">INT</label>
            <input id="int" type="number" placeholder="18" />
          </div>
          <div class="field col-2 col-3">
            <label for="wis">WIS</label>
            <input id="wis" type="number" placeholder="15" />
          </div>
          <div class="field col-2 col-3">
            <label for="cha">CHA</label>
            <input id="cha" type="number" placeholder="23" />
          </div>
        </div>

        <div class="toolbar-row">
          <div class="field col-6">
            <label for="saves"
              >Saving Throws (e.g., Dex +7, Con +16, Wis +9, Cha +13)</label
            >
            <input id="saves" type="text" />
          </div>
          <div class="field col-6">
            <label for="skills"
              >Skills (e.g., Perception +16, Stealth +10, Intimidation +12)</label
            >
            <input id="skills" type="text" />
          </div>
        </div>

        <div class="toolbar-row">
          <div class="field col-6">
            <label for="resist"
              >Damage Resistances (semicolon or comma separated)</label
            >
            <input
              id="resist"
              type="text"
              placeholder="bludgeoning, piercing, and slashing from nonmagical attacks"
            />
          </div>
          <div class="field col-6">
            <label for="immune">Damage Immunities</label>
            <input id="immune" type="text" placeholder="fire" />
          </div>
        </div>

        <div class="toolbar-row">
          <div class="field col-6">
            <label for="cond_imm">Condition Immunities</label>
            <input id="cond_imm" type="text" />
          </div>
          <div class="field col-6">
            <label for="senses">Senses</label>
            <input
              id="senses"
              type="text"
              placeholder="blindsight 60 ft., darkvision 120 ft., passive Perception 23"
            />
          </div>
        </div>

        <div class="toolbar-row">
          <div class="field col-6">
            <label for="languages">Languages</label>
            <input id="languages" type="text" placeholder="Common, Draconic" />
          </div>
          <div class="field col-6">
            <label for="source">Source / Notes</label>
            <input id="source" type="text" placeholder="MM p. 98" />
          </div>
        </div>

        <div class="toolbar-row">
          <div class="field col-12">
            <label for="traits">Traits (JSON array: [{"name":"X","text":"Y"}])</label>
            <textarea id="traits"></textarea>
          </div>
        </div>

        <div class="toolbar-row">
          <div class="field col-12">
            <label for="actions">Actions (JSON array)</label>
            <textarea id="actions"></textarea>
          </div>
        </div>

        <div class="toolbar-row">
          <div class="field col-12">
            <label for="reactions">Reactions (JSON array)</label>
            <textarea id="reactions"></textarea>
          </div>
        </div>

        <div class="toolbar-row">
          <div class="field col-12">
            <label for="legendary">Legendary Actions (JSON array)</label>
            <textarea id="legendary"></textarea>
          </div>
        </div>

        <div class="toolbar-row">
          <div class="field col-12">
            <label for="desc">Description / DM Notes (plain text)</label>
            <textarea
              id="desc"
              placeholder="Tactics, lair notes, flavor, etc."
            ></textarea>
          </div>
        </div>

        <div class="actions">
          <button class="btn primary" id="btn-apply">Apply</button>
          <button class="btn" id="btn-update-url">Update URL</button>
          <button class="btn" id="btn-copy-view">Copy View-Only Link</button>
          <button class="btn" id="btn-copy-embed">Copy Embed Link</button>
          <button class="btn" id="btn-clear">Clear</button>
          <span class="footer-note"
            >All data is stored in the URL query string.</span
          >
        </div>
      </div>

      <div class="statblock" id="statblock">
        <div class="sb-header">
          <div class="sb-name" id="sb-name">Creature Name</div>
          <div class="sb-subtitle small" id="sb-subtitle">
            Size type, alignment
          </div>
        </div>
        <div class="sb-body">
          <div class="sb-row small">
            <span class="sb-label">Armor Class</span>
            <span id="sb-ac">—</span>
          </div>
          <div class="sb-row small">
            <span class="sb-label">Hit Points</span>
            <span id="sb-hp">—</span>
          </div>
          <div class="sb-row small">
            <span class="sb-label">Speed</span>
            <span id="sb-speed">—</span>
          </div>

          <div class="hr"></div>

          <div class="abilities">
            <div class="ability">
              <div class="abbr">STR</div>
              <div class="score" id="sb-str">10</div>
              <div class="mod" id="sb-str-mod">(+0)</div>
            </div>
            <div class="ability">
              <div class="abbr">DEX</div>
              <div class="score" id="sb-dex">10</div>
              <div class="mod" id="sb-dex-mod">(+0)</div>
            </div>
            <div class="ability">
              <div class="abbr">CON</div>
              <div class="score" id="sb-con">10</div>
              <div class="mod" id="sb-con-mod">(+0)</div>
            </div>
            <div class="ability">
              <div class="abbr">INT</div>
              <div class="score" id="sb-int">10</div>
              <div class="mod" id="sb-int-mod">(+0)</div>
            </div>
            <div class="ability">
              <div class="abbr">WIS</div>
              <div class="score" id="sb-wis">10</div>
              <div class="mod" id="sb-wis-mod">(+0)</div>
            </div>
            <div class="ability">
              <div class="abbr">CHA</div>
              <div class="score" id="sb-cha">10</div>
              <div class="mod" id="sb-cha-mod">(+0)</div>
            </div>
          </div>

          <div class="hr"></div>

          <div class="sb-row small" id="sb-saves-row" style="display: none;">
            <span class="sb-label">Saving Throws</span>
            <span id="sb-saves"></span>
          </div>
          <div class="sb-row small" id="sb-skills-row" style="display: none;">
            <span class="sb-label">Skills</span>
            <span id="sb-skills"></span>
          </div>
          <div class="sb-row small" id="sb-resist-row" style="display: none;">
            <span class="sb-label">Damage Resistances</span>
            <span id="sb-resist"></span>
          </div>
          <div class="sb-row small" id="sb-immune-row" style="display: none;">
            <span class="sb-label">Damage Immunities</span>
            <span id="sb-immune"></span>
          </div>
          <div
            class="sb-row small"
            id="sb-cond-imm-row"
            style="display: none;"
          >
            <span class="sb-label">Condition Immunities</span>
            <span id="sb-cond-imm"></span>
          </div>
          <div class="sb-row small">
            <span class="sb-label">Senses</span>
            <span id="sb-senses">—</span>
          </div>
          <div class="sb-row small">
            <span class="sb-label">Languages</span>
            <span id="sb-languages">—</span>
          </div>
          <div class="sb-row small">
            <span class="sb-label">Challenge</span>
            <span id="sb-cr">—</span>
          </div>

          <div class="hr"></div>

          <div class="section" id="sb-traits-section" style="display: none;">
            <div class="entry-list" id="sb-traits"></div>
          </div>

          <div class="section">
            <div class="entry">
              <div class="name">Actions</div>
            </div>
            <div class="entry-list" id="sb-actions"></div>
          </div>

          <div
            class="section"
            id="sb-reactions-section"
            style="display: none;"
          >
            <div class="entry">
              <div class="name">Reactions</div>
            </div>
            <div class="entry-list" id="sb-reactions"></div>
          </div>

          <div
            class="section"
            id="sb-legendary-section"
            style="display: none;"
          >
            <div class="entry">
              <div class="name">Legendary Actions</div>
            </div>
            <div class="entry-list" id="sb-legendary"></div>
          </div>

          <div class="section" id="sb-desc-section" style="display: none;">
            <div class="entry">
              <div class="name">Description</div>
            </div>
            <div class="description" id="sb-desc"></div>
          </div>

          <div class="footer-note small" id="sb-source"></div>
        </div>
      </div>

      <div class="footer-note" id="tips">
        Tips:
        <ul>
          <li>
            Click "Update URL" to rewrite the address bar with your current
            data.
          </li>
          <li>Share the full URL. Everything is encoded in the query string.</li>
          <li>Add view=1 to hide the editor; add embed=1 for minimal embed.</li>
        </ul>
      </div>
    </div>

    <script>
      // Utility and rendering -------------------------------------------------
      function toInt(val, fallback = 10) {
        const n = parseInt(val, 10);
        return Number.isFinite(n) ? n : fallback;
      }

      function mod(score) {
        const m = Math.floor((score - 10) / 2);
        return m;
      }

      function fmtMod(m) {
        return (m >= 0 ? "+" : "") + m;
      }

      function safeParseArray(input) {
        if (!input) return [];
        try {
          return JSON.parse(input);
        } catch (e) {
          try {
            const fixed = input
              .trim()
              .replace(/([{,]\s*)'([^']+)'(\s*:)/g, '$1"$2"$3')
              .replace(/:\s*'([^']+)'/g, ': "$1"')
              .replace(/'(\s*[}\]])/g, '"$1');
            return JSON.parse(fixed);
          } catch (e2) {
            return [];
          }
        }
      }

      function setDisplay(el, show) {
        el.style.display = show ? "" : "none";
      }

      function field(id) {
        return document.getElementById(id);
      }

      function text(id, val) {
        field(id).textContent = val || "—";
      }

      function joinClean(arr) {
        return arr
          .map((s) => String(s || "").trim())
          .filter(Boolean)
          .join(", ");
      }

      function fillAbilities(stats) {
        const keys = ["str", "dex", "con", "int", "wis", "cha"];
        keys.forEach((k) => {
          const score = toInt(stats[k], 10);
          const m = mod(score);
          text("sb-" + k, score);
          text("sb-" + k + "-mod", "(" + fmtMod(m) + ")");
        });
      }

      function renderEntries(containerId, list) {
        const el = field(containerId);
        el.innerHTML = "";
        list.forEach((it) => {
          const wrap = document.createElement("div");
          wrap.className = "entry small";
          const nm = document.createElement("div");
          nm.className = "name";
          nm.textContent = it.name || "";
          const tx = document.createElement("div");
          tx.className = "text";
          tx.textContent = it.text || "";
          wrap.appendChild(nm);
          wrap.appendChild(tx);
          el.appendChild(wrap);
        });
      }

      function applyToStatblock(data) {
        // Header
        text("sb-name", data.name);
        const subtitle = joinClean([data.size, data.type, data.alignment]);
        text("sb-subtitle", subtitle);

        // Top lines
        text("sb-ac", data.ac);
        text("sb-hp", data.hp);
        text("sb-speed", data.speed || "—");

        // Abilities
        fillAbilities(data);

        // Details rows
        if (data.saves) {
          setDisplay(field("sb-saves-row"), true);
          text("sb-saves", data.saves);
        } else {
          setDisplay(field("sb-saves-row"), false);
        }

        if (data.skills) {
          setDisplay(field("sb-skills-row"), true);
          text("sb-skills", data.skills);
        } else {
          setDisplay(field("sb-skills-row"), false);
        }

        if (data.resist) {
          setDisplay(field("sb-resist-row"), true);
          text("sb-resist", data.resist);
        } else {
          setDisplay(field("sb-resist-row"), false);
        }

        if (data.immune) {
          setDisplay(field("sb-immune-row"), true);
          text("sb-immune", data.immune);
        } else {
          setDisplay(field("sb-immune-row"), false);
        }

        if (data.cond_imm) {
          setDisplay(field("sb-cond-imm-row"), true);
          text("sb-cond-imm", data.cond_imm);
        } else {
          setDisplay(field("sb-cond-imm-row"), false);
        }

        text("sb-senses", data.senses);
        text("sb-languages", data.languages);
        text("sb-cr", data.cr);

        // Traits, Actions, Reactions, Legendary
        const traits = safeParseArray(data.traits);
        const actions = safeParseArray(data.actions);
        const reactions = safeParseArray(data.reactions);
        const legendary = safeParseArray(data.legendary);

        setDisplay(field("sb-traits-section"), traits.length > 0);
        renderEntries("sb-traits", traits);

        renderEntries("sb-actions", actions);

        setDisplay(field("sb-reactions-section"), reactions.length > 0);
        renderEntries("sb-reactions", reactions);

        setDisplay(field("sb-legendary-section"), legendary.length > 0);
        renderEntries("sb-legendary", legendary);

        // Description
        if ((data.desc || "").trim()) {
          setDisplay(field("sb-desc-section"), true);
          field("sb-desc").textContent = data.desc;
        } else {
          setDisplay(field("sb-desc-section"), false);
        }

        // Source
        field("sb-source").textContent = data.source || "";
      }

      function pullFromForm() {
        return {
          name: field("name").value,
          size: field("size").value,
          type: field("type").value,
          alignment: field("alignment").value,
          ac: field("ac").value,
          hp: field("hp").value,
          hit_dice: field("hit_dice").value,
          speed: field("speed").value,
          str: field("str").value,
          dex: field("dex").value,
          con: field("con").value,
          int: field("int").value,
          wis: field("wis").value,
          cha: field("cha").value,
          prof: field("prof").value,
          saves: field("saves").value,
          skills: field("skills").value,
          resist: field("resist").value,
          immune: field("immune").value,
          cond_imm: field("cond_imm").value,
          senses: field("senses").value,
          languages: field("languages").value,
          cr: field("cr").value,
          traits: field("traits").value,
          actions: field("actions").value,
          reactions: field("reactions").value,
          legendary: field("legendary").value,
          desc: field("desc").value,
          source: field("source").value,
        };
      }

      function pushToForm(d) {
        field("name").value = d.name || "";
        field("size").value = d.size || "";
        field("type").value = d.type || "";
        field("alignment").value = d.alignment || "";
        field("ac").value = d.ac || "";
        field("hp").value = d.hp || "";
        field("hit_dice").value = d.hit_dice || "";
        field("speed").value = d.speed || "";
        field("str").value = d.str || "";
        field("dex").value = d.dex || "";
        field("con").value = d.con || "";
        field("int").value = d.int || "";
        field("wis").value = d.wis || "";
        field("cha").value = d.cha || "";
        field("prof").value = d.prof || "";
        field("saves").value = d.saves || "";
        field("skills").value = d.skills || "";
        field("resist").value = d.resist || "";
        field("immune").value = d.immune || "";
        field("cond_imm").value = d.cond_imm || "";
        field("senses").value = d.senses || "";
        field("languages").value = d.languages || "";
        field("cr").value = d.cr || "";
        field("traits").value = d.traits || "";
        field("actions").value = d.actions || "";
        field("reactions").value = d.reactions || "";
        field("legendary").value = d.legendary || "";
        field("desc").value = d.desc || "";
        field("source").value = d.source || "";
      }

      function encodeParams(data) {
        const params = new URLSearchParams();
        Object.entries(data).forEach(([k, v]) => {
          if (v != null && String(v).trim() !== "") {
            params.set(k, v);
          }
        });
        return params;
      }

      function decodeParams() {
        const urlParams = new URLSearchParams(window.location.search);
        const data = {};
        urlParams.forEach((value, key) => {
          data[key] = value;
        });
        return data;
      }

      function updateUrl(data, extra = {}) {
        const params = encodeParams({ ...data, ...extra });
        const newUrl =
          window.location.pathname +
          (params.toString() ? "?" + params.toString() : "");
        window.history.replaceState({}, "", newUrl);
      }

      function clearAll() {
        const inputs = document.querySelectorAll(
          "input[type='text'], input[type='number'], textarea"
        );
        inputs.forEach((i) => (i.value = ""));
        applyToStatblock({});
        updateUrl({});
      }

      function copyLinkWithFlag(flag, val) {
        const d = pullFromForm();
        const params = encodeParams(d);
        if (val == null) {
          params.delete(flag);
        } else {
          params.set(flag, String(val));
        }
        const url =
          window.location.origin +
          window.location.pathname +
          (params.toString() ? "?" + params.toString() : "");
        navigator.clipboard
          .writeText(url)
          .then(() => alert("Link copied to clipboard"))
          .catch(() => alert("Copy failed. You can copy from the address bar."));
      }

      function applyViewModes() {
        const data = decodeParams();
        const isEmbed = data.embed === "1" || data.embed === "true";
        const isView = data.view === "1" || data.view === "true";

        if (isEmbed) {
          // Minimal, borderless: hide editor and tips
          document.body.classList.add("embed-root");
          field("toolbar").classList.add("hidden");
          field("tips").classList.add("hidden");
        } else if (isView) {
          // Hide editor and tips, keep margins
          field("toolbar").classList.add("hidden");
          field("tips").classList.add("hidden");
        } else {
          field("toolbar").classList.remove("hidden");
          field("tips").classList.remove("hidden");
        }
      }

      // Initial load ----------------------------------------------------------
      window.addEventListener("DOMContentLoaded", () => {
        const data = decodeParams();

        // Preload example if empty
        const preloadIfEmpty = Object.keys(data).length === 0;
        const example = {
          name: "Adult Red Dragon",
          size: "Huge",
          type: "dragon",
          alignment: "chaotic evil",
          ac: "19 (natural armor)",
          hp: "256 (19d12 + 133)",
          hit_dice: "19d12+133",
          speed: "40 ft., climb 40 ft., fly 80 ft.",
          str: "27",
          dex: "10",
          con: "25",
          int: "16",
          wis: "13",
          cha: "21",
          prof: "+6",
          saves: "Dex +6, Con +13, Wis +7, Cha +10",
          skills: "Perception +13, Stealth +6",
          resist: "",
          immune: "fire",
          cond_imm: "",
          senses: "blindsight 60 ft., darkvision 120 ft., passive Perception 23",
          languages: "Common, Draconic",
          cr: "17 (18,000 XP)",
          traits:
            '[{"name":"Legendary Resistance (3/Day)","text":"If the dragon fails a saving throw, it can choose to succeed instead."}]',
          actions:
            '[' +
            '{"name":"Multiattack","text":"The dragon can use its Frightful Presence. It then makes three attacks: one with its bite and two with its claws."},' +
            '{"name":"Bite","text":"+14 to hit, reach 10 ft., one target. Hit: 19 (2d10 + 8) piercing damage plus 7 (2d6) fire damage."},' +
            '{"name":"Claw","text":"+14 to hit, reach 5 ft., one target. Hit: 15 (2d6 + 8) slashing damage."},' +
            '{"name":"Tail","text":"+14 to hit, reach 15 ft., one target. Hit: 17 (2d8 + 8) bludgeoning damage."},' +
            '{"name":"Frightful Presence","text":"Each creature of the dragon’s choice that is within 120 feet of the dragon and aware of it must succeed on a DC 18 Wisdom saving throw or become frightened for 1 minute."},' +
            '{"name":"Fire Breath (Recharge 5–6)","text":"The dragon exhales fire in a 60-foot cone. Each creature in that area must make a DC 21 Dexterity saving throw, taking 63 (18d6) fire damage on a failed save, or half as much on a successful one."}' +
            "]",
          reactions: "[]",
          legendary:
            '[' +
            '{"name":"Detect","text":"The dragon makes a Wisdom (Perception) check."},' +
            '{"name":"Tail Attack","text":"The dragon makes a tail attack."},' +
            '{"name":"Wing Attack (Costs 2 Actions)","text":"The dragon beats its wings. Each creature within 10 feet must succeed on a DC 22 Dexterity saving throw or take 13 (2d6 + 6) bludgeoning damage and be knocked prone. The dragon can then fly up to half its flying speed."}' +
            "]",
          desc:
            "A proud and terrible tyrant of the skies, adult red dragons rule mountainous territories and demand tribute from all who dwell below.",
          source: "Hiraeth",
        };

        if (preloadIfEmpty) {
          pushToForm(example);
          applyToStatblock(example);
          updateUrl(example);
        } else {
          pushToForm(data);
          applyToStatblock(data);
        }

        applyViewModes();

        // Editor buttons
        field("btn-apply").addEventListener("click", () => {
          const d = pullFromForm();
          applyToStatblock(d);
        });

        field("btn-update-url").addEventListener("click", () => {
          const d = pullFromForm();
          updateUrl(d);
        });

        field("btn-clear").addEventListener("click", () => {
          clearAll();
        });

        field("btn-copy-view").addEventListener("click", () => {
          copyLinkWithFlag("view", 1);
        });

        field("btn-copy-embed").addEventListener("click", () => {
          copyLinkWithFlag("embed", 1);
        });
      });
    </script>
  </body>
</html>